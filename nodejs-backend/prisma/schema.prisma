datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model collection {
  id          BigInt   @id @default(autoincrement())
  owner_id    BigInt
  title       String
  description String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  users       users    @relation(fields: [owner_id], references: [id], onUpdate: NoAction, map: "fk_collection_owner")
  item        item[]
}

model item {
  id            BigInt     @id @default(autoincrement())
  collection_id BigInt
  title         String
  description   String?
  image_url     String?
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  collection    collection @relation(fields: [collection_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_item_collection")
}

model room {
  id               BigInt             @id @default(autoincrement())
  creator_id       BigInt
  name             String
  topic            String?
  type             type_enum
  match_mode       match_mode_enum
  status           status_enum
  access_mode      access_mode_enum
  password_hash    String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  result           Json?
  closed_at        DateTime?          @db.Timestamptz(6)
  users            users              @relation(fields: [creator_id], references: [id], onUpdate: NoAction, map: "fk_room_creator")
  room_participant room_participant[]
}

model room_participant {
  room_id     BigInt
  user_id     BigInt
  joined_at   DateTime  @default(now()) @db.Timestamptz(6)
  finished_at DateTime? @db.Timestamptz(6)
  room        room      @relation(fields: [room_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_room_participant_room")
  users       users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_room_participant_user")

  @@id([room_id, user_id], map: "pk_room_participant")
}

model users {
  id               BigInt             @id @default(autoincrement())
  display_name     String
  email            String             @unique
  avatar_url       String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  password_hash    String
  collection       collection[]
  room             room[]
  room_participant room_participant[]
}

enum access_mode_enum {
  PUBLIC
  PRIVATE
}

enum match_mode_enum {
  FIRST_MATCH
  WATCH_ALL
}

enum status_enum {
  OPEN
  ACTIVE
  CLOSED
}

enum type_enum {
  SINGLE
  COMBINED
}
